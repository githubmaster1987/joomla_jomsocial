<?php
/**
* @copyright (C) 2015 iJoomla, Inc. - All rights reserved.
* @license GNU General Public License, version 2 (http://www.gnu.org/licenses/gpl-2.0.html)
* @author iJoomla.com <webmaster@ijoomla.com>
* @url https://www.jomsocial.com/license-agreement
* The PHP code portions are distributed under the GPL license. If not otherwise stated, all images, manuals, cascading style sheets, and included JavaScript *are NOT GPL, and are released under the IJOOMLA Proprietary Use License v1.0
* More info at https://www.jomsocial.com/license-agreement
*/
defined('_JEXEC') or die('Restricted access');
?>

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="498" height="144" viewBox="0 0 498 144" class="joms-hide">
<defs>
<g id="joms-icon-bullhorn">
    <path class="path1" d="M16 6.707c0-3.139-0.919-5.687-2.054-5.707 0.005-0 0.009-0 0.014-0h-1.296c0 0-3.044 2.287-7.425 3.184-0.134 0.708-0.219 1.551-0.219 2.523 0 0.972 0.085 1.816 0.219 2.523 4.382 0.897 7.425 3.184 7.425 3.184h1.296c-0.005 0-0.009-0-0.014-0.001 1.136-0.020 2.054-2.567 2.054-5.707zM13.513 11.551c-0.147 0-0.305-0.152-0.387-0.243-0.197-0.22-0.387-0.562-0.55-0.989-0.363-0.957-0.564-2.239-0.564-3.611 0-1.372 0.2-2.655 0.564-3.611 0.162-0.428 0.353-0.77 0.55-0.99 0.081-0.091 0.24-0.243 0.387-0.243 0.147 0 0.305 0.152 0.387 0.243 0.197 0.22 0.387 0.562 0.55 0.99 0.363 0.957 0.564 2.239 0.564 3.611 0 1.372-0.2 2.655-0.564 3.611-0.162 0.428-0.353 0.77-0.55 0.989-0.081 0.091-0.24 0.243-0.387 0.243zM3.935 6.707c0-0.812 0.060-1.6 0.173-2.33-0.74 0.102-1.39 0.161-2.193 0.161-1.048 0-1.048 0-1.048 0l-0.867 1.479v1.378l0.867 1.479c0 0 0 0 1.048 0 0.803 0 1.453 0.059 2.193 0.161-0.113-0.729-0.173-1.518-0.173-2.33zM5.752 10.034l-2-0.383 1.279 5.024c0.066 0.26 0.324 0.391 0.573 0.291l1.852-0.741c0.249-0.1 0.349-0.374 0.222-0.611l-1.926-3.581zM13.513 8.574c-0.057 0-0.118-0.059-0.149-0.094-0.076-0.085-0.149-0.217-0.212-0.381-0.14-0.369-0.217-0.863-0.217-1.392 0-0.529 0.077-1.023 0.217-1.392 0.063-0.165 0.136-0.297 0.212-0.381 0.031-0.035 0.092-0.094 0.149-0.094 0.056 0 0.118 0.059 0.149 0.094 0.076 0.085 0.149 0.217 0.212 0.381 0.14 0.369 0.217 0.863 0.217 1.392 0 0.529-0.077 1.023-0.217 1.392-0.063 0.165-0.136 0.297-0.212 0.381-0.031 0.035-0.092 0.094-0.149 0.094z"></path>
</g>
<g id="joms-icon-users">
    <path class="path1" d="M11.484 12.584c-0.296-0.047-0.303-0.854-0.303-0.854s0.87-0.854 1.060-2.002c0.51 0 0.825-1.221 0.315-1.65 0.021-0.452 0.656-3.55-2.556-3.55-3.212 0-2.577 3.097-2.556 3.55-0.51 0.43-0.195 1.65 0.315 1.65 0.19 1.148 1.060 2.002 1.060 2.002s-0.007 0.807-0.303 0.854c-0.954 0.15-4.516 1.708-4.516 3.416h12c0-1.708-3.562-3.266-4.516-3.416zM5.376 12.856c0.689-0.424 1.525-0.817 2.212-1.053-0.246-0.351-0.52-0.827-0.693-1.392-0.241-0.196-0.437-0.477-0.562-0.822-0.126-0.345-0.174-0.732-0.135-1.089 0.028-0.256 0.101-0.495 0.213-0.705-0.068-0.728-0.116-2.157 0.819-3.199 0.363-0.404 0.821-0.695 1.37-0.87-0.098-1.012-0.612-2.2-2.601-2.2-3.212 0-2.577 3.097-2.556 3.55-0.51 0.43-0.195 1.65 0.315 1.65 0.19 1.148 1.060 2.002 1.060 2.002s-0.007 0.807-0.303 0.854c-0.954 0.151-4.516 1.708-4.516 3.416h5.15c0.074-0.048 0.149-0.096 0.226-0.144z"></path>
</g>
<g id="joms-icon-envelope">
    <path class="path1" d="M14.5 2h-13c-0.825 0-1.5 0.675-1.5 1.5v10c0 0.825 0.675 1.5 1.5 1.5h13c0.825 0 1.5-0.675 1.5-1.5v-10c0-0.825-0.675-1.5-1.5-1.5zM6.23 8.6l-4.23 3.295v-7.838l4.23 4.543zM2.756 4h10.488l-5.244 3.938-5.244-3.938zM6.395 8.777l1.605 1.723 1.605-1.723 3.29 4.223h-9.79l3.29-4.223zM9.77 8.6l4.23-4.543v7.838l-4.23-3.295z"></path>
</g>
</defs>
</svg>


<?php
if( $my->isOnline() && $my->id != 0 )
{
    $jinput = JFactory::getApplication()->input;
    $inboxModel         = CFactory::getModel('inbox');
    $notifModel = CFactory::getModel('notification');
    $filter             = array();
    $filter['user_id']  = $my->id;
    $friendModel        = CFactory::getModel ( 'friends' );
    $profileid          = $jinput->get('userid' , 0);

    //CFactory::load( 'libraries' , 'toolbar' );
    $toolbar = CToolbarLibrary::getInstance();
    $newMessageCount        = $toolbar->getTotalNotifications( 'inbox' );
    $newEventInviteCount    = $toolbar->getTotalNotifications( 'events' );
    $newFriendInviteCount   = $toolbar->getTotalNotifications( 'friends' );
    $newGroupInviteCount    = $toolbar->getTotalNotifications( 'groups' );

    $myParams           =   $my->getParams();
    $newNotificationCount   = $notifModel->getNotificationCount($my->id,'0',$myParams->get('lastnotificationlist',''));
    $newEventInviteCount    = $newEventInviteCount + $newNotificationCount;

    //CFactory::load( 'helpers' , 'string');

    $config = CFactory::getConfig();
    $uri    = CRoute::_('index.php?option=com_community' , false );
    $uri    = base64_encode($uri);

    //CFactory::load('helpers' , 'string' );

    $show_global_notification   = $params->get('show_notification', 1);
    $show_friend_request    = $params->get('show_request', 1);
    $enable_private_message     = $params->get('show_privatemsg', 1);

    // IDs.
    $mainframe = JFactory::getApplication();
    $jinput = $mainframe->input;
    $my = CFactory::getUser();
    $userid = $jinput->get('userid', '', 'INT');
    $user = CFactory::getUser($userid);

    $document->addScriptDeclaration('joms_my_id = ' . $my->id . ';');
    $document->addScriptDeclaration('joms_user_id = ' . $user->id . ';');

?>

<div class="joms-notifications">
    <?php if ($show_global_notification) { ?>
    <a title="<?php echo JText::_('COM_COMMUNITY_NOTIFICATIONS_GLOBAL'); ?>"
            href="javascript:" onclick="joms.popup.notification.global();">
        <svg viewBox="0 0 16 16" class="joms-icon">
            <use xlink:href="#joms-icon-bullhorn"></use>
        </svg>
        <span class="joms-js--notiflabel-general"><?php echo ($newEventInviteCount) ? $newEventInviteCount : 0 ;?></span>
    </a>
    <?php } ?>
    <?php if ($show_friend_request) { ?>
    <a title="<?php echo JText::_('COM_COMMUNITY_NOTIFICATIONS_INVITE_FRIENDS'); ?>"
            href="<?php echo CRoute::_('index.php?option=com_community&view=friends&task=pending'); ?>"
            onclick="joms.popup.notification.friend(); return false;">
        <svg viewBox="0 0 16 16" class="joms-icon">
            <use xlink:href="#joms-icon-users"></use>
        </svg>
        <span class="joms-js--notiflabel-frequest"><?php echo ($newFriendInviteCount) ? $newFriendInviteCount : 0 ;?></span>
    </a>
    <?php } ?>
    <?php if ($enable_private_message) { ?>
    <a title="<?php echo JText::_('COM_COMMUNITY_NOTIFICATIONS_INBOX'); ?>"
            href="<?php echo CRoute::_('index.php?option=com_community&view=inbox'); ?>"
            onclick="joms.popup.notification.pm(); return false;">
        <svg viewBox="0 0 16 16" class="joms-icon">
            <use xlink:href="#joms-icon-envelope"></use>
        </svg>
        <span class="joms-js--notiflabel-inbox"><?php echo ($newMessageCount) ? $newMessageCount : 0 ;?></span>
    </a>
    <?php } ?>
</div>

<?php
    }
?>
